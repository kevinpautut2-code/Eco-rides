<!DOCTYPE html>
<html lang="fr" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trajet en cours - EcoRide</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="css/design-system.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/components.css">

    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üå±</text></svg>">

    <style>
        .pulse-animation {
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.05); }
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-eco);
            transition: width 0.5s ease;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 0.5rem;
        }

        .status-active {
            background: var(--success-green);
            box-shadow: 0 0 8px var(--success-green);
            animation: blink 1.5s ease-in-out infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
    </style>
</head>
<body>
    <nav class="navbar" id="navbar">
        <div class="navbar-container">
            <a href="index.html" class="navbar-brand">
                <div class="navbar-logo">üå±</div>
                <span>EcoRide</span>
            </a>

            <div class="navbar-actions">
                <button class="theme-toggle" id="themeToggle">
                    <div class="theme-toggle-slider">
                        <span id="themeIcon">‚òÄÔ∏è</span>
                    </div>
                </button>
            </div>
        </div>
    </nav>

    <div class="container" style="margin-top: 2rem; margin-bottom: 4rem;">
        <!-- Status Header -->
        <div class="card mb-lg" style="background: var(--gradient-dark); color: white;">
            <div class="card-body" style="padding: 2rem;">
                <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem;">
                    <div>
                        <div style="display: flex; align-items: center; margin-bottom: 0.5rem;">
                            <span class="status-indicator status-active"></span>
                            <h1 style="color: white; margin: 0;" id="rideStatus">Trajet pr√™t √† d√©marrer</h1>
                        </div>
                        <p style="color: rgba(255,255,255,0.9); margin: 0;">Paris ‚Üí Lyon ‚Ä¢ Trajet #1250</p>
                    </div>
                    <div style="text-align: center; background: rgba(255,255,255,0.2); padding: 1rem 1.5rem; border-radius: var(--radius-lg);">
                        <div style="font-size: 2rem; font-weight: bold; color: white;" id="timer">00:00:00</div>
                        <div style="color: rgba(255,255,255,0.9); font-size: var(--font-size-sm);">Temps √©coul√©</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress -->
        <div class="card mb-md">
            <div class="card-body">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3 style="margin: 0;">üìç Progression du trajet</h3>
                    <span id="progressPercent" style="font-weight: 600; color: var(--primary-green);">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar" style="width: 0%;"></div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 0.5rem; font-size: var(--font-size-sm); color: var(--text-tertiary);">
                    <span>D√©part</span>
                    <span>Arriv√©e estim√©e: 13:45</span>
                </div>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem;">
            <!-- Route Info -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üó∫Ô∏è Itin√©raire</h3>
                </div>
                <div class="card-body">
                    <div style="margin-bottom: 1rem;">
                        <p style="margin-bottom: 0.5rem;"><strong>üìç D√©part</strong></p>
                        <p style="margin: 0; color: var(--text-secondary);">1 Place de la R√©publique<br>75003 Paris</p>
                    </div>
                    <div style="border-left: 3px dashed var(--border-medium); height: 40px; margin-left: 1rem;"></div>
                    <div>
                        <p style="margin-bottom: 0.5rem;"><strong>üéØ Arriv√©e</strong></p>
                        <p style="margin: 0; color: var(--text-secondary);">15 Rue de la R√©publique<br>69001 Lyon</p>
                    </div>
                    <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid var(--border-light);">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="color: var(--text-tertiary);">Distance totale:</span>
                            <strong>465 km</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-tertiary);">Dur√©e estim√©e:</span>
                            <strong>4h 45min</strong>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üìä Statistiques</h3>
                </div>
                <div class="card-body">
                    <div style="margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="color: var(--text-tertiary);">üöô V√©hicule:</span>
                            <strong>Tesla Model 3 ‚ö°</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="color: var(--text-tertiary);">üë• Passagers:</span>
                            <strong id="passengerCount">2/3</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="color: var(--text-tertiary);">üí∞ Revenus pr√©vus:</span>
                            <strong style="color: var(--primary-green);">+86 cr√©dits</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-tertiary);">üå± CO‚ÇÇ √©conomis√©:</span>
                            <strong style="color: var(--success-green);">~55 kg</strong>
                        </div>
                    </div>
                    <div style="padding-top: 1rem; border-top: 1px solid var(--border-light);">
                        <button class="btn btn-primary" style="width: 100%;" onclick="openNavigation()">
                            <span>üß≠</span>
                            <span>Ouvrir la navigation</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Passengers List -->
        <div class="card mb-lg">
            <div class="card-header">
                <h3 class="card-title">üë• Passagers (2)</h3>
            </div>
            <div class="card-body">
                <!-- Passenger 1 -->
                <div class="card mb-md" style="border: 2px solid var(--border-light);">
                    <div class="card-body">
                        <div style="display: flex; align-items: center; justify-content: space-between; gap: 1rem; flex-wrap: wrap;">
                            <div style="display: flex; align-items: center; gap: 1rem; flex: 1;">
                                <img src="https://i.pravatar.cc/60?img=2" alt="Passager" style="width: 60px; height: 60px; border-radius: 50%; border: 2px solid var(--primary-green);">
                                <div>
                                    <h4 style="margin: 0 0 0.25rem 0;">Marie Dubois</h4>
                                    <p style="margin: 0; color: var(--text-tertiary); font-size: var(--font-size-sm);">@marie_d ‚Ä¢ ‚≠ê 4.8/5</p>
                                </div>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn btn-secondary btn-sm" onclick="callPassenger('marie_d', '+33612345678')">
                                    <span>üìû</span>
                                    <span>Appeler</span>
                                </button>
                                <button class="btn btn-primary btn-sm" onclick="messagePassenger('marie_d')">
                                    <span>üí¨</span>
                                    <span>Message</span>
                                </button>
                                <button class="btn btn-success btn-sm" id="pickup-marie" onclick="markPickedUp('marie_d')">
                                    <span>‚úì</span>
                                    <span>Embarqu√©</span>
                                </button>
                            </div>
                        </div>
                        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-light);">
                            <p style="margin: 0; color: var(--text-tertiary); font-size: var(--font-size-sm);">
                                üìç Mont√©e pr√©vue: 1 Place de la R√©publique, 75003 Paris
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Passenger 2 -->
                <div class="card" style="border: 2px solid var(--border-light);">
                    <div class="card-body">
                        <div style="display: flex; align-items: center; justify-content: space-between; gap: 1rem; flex-wrap: wrap;">
                            <div style="display: flex; align-items: center; gap: 1rem; flex: 1;">
                                <img src="https://i.pravatar.cc/60?img=3" alt="Passager" style="width: 60px; height: 60px; border-radius: 50%; border: 2px solid var(--primary-green);">
                                <div>
                                    <h4 style="margin: 0 0 0.25rem 0;">Julien Petit</h4>
                                    <p style="margin: 0; color: var(--text-tertiary); font-size: var(--font-size-sm);">@julien_p ‚Ä¢ ‚≠ê 4.6/5</p>
                                </div>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn btn-secondary btn-sm" onclick="callPassenger('julien_p', '+33698765432')">
                                    <span>üìû</span>
                                    <span>Appeler</span>
                                </button>
                                <button class="btn btn-primary btn-sm" onclick="messagePassenger('julien_p')">
                                    <span>üí¨</span>
                                    <span>Message</span>
                                </button>
                                <button class="btn btn-success btn-sm" id="pickup-julien" onclick="markPickedUp('julien_p')">
                                    <span>‚úì</span>
                                    <span>Embarqu√©</span>
                                </button>
                            </div>
                        </div>
                        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-light);">
                            <p style="margin: 0; color: var(--text-tertiary); font-size: var(--font-size-sm);">
                                üìç Mont√©e pr√©vue: 1 Place de la R√©publique, 75003 Paris
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="card">
            <div class="card-body">
                <div id="preStartActions" style="display: block;">
                    <div class="alert alert-info" style="margin-bottom: 1rem;">
                        ‚ÑπÔ∏è <strong>Avant de d√©marrer:</strong> Assurez-vous que tous les passagers sont √† bord et que vous √™tes pr√™t √† partir.
                    </div>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button class="btn btn-primary" style="flex: 2;" onclick="startRide()">
                            <span>‚ñ∂Ô∏è</span>
                            <span>D√©marrer le trajet</span>
                        </button>
                        <button class="btn btn-secondary" style="flex: 1;" onclick="reportIssue()">
                            <span>‚ö†Ô∏è</span>
                            <span>Signaler un probl√®me</span>
                        </button>
                        <button class="btn btn-danger" style="flex: 1;" onclick="cancelRideFromActive()">
                            <span>‚ùå</span>
                            <span>Annuler</span>
                        </button>
                    </div>
                </div>

                <div id="duringRideActions" style="display: none;">
                    <div class="alert alert-success pulse-animation" style="margin-bottom: 1rem;">
                        ‚úÖ <strong>Trajet en cours!</strong> Conduisez prudemment et respectez le code de la route.
                    </div>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button class="btn btn-warning" style="flex: 1;" onclick="pauseRide()">
                            <span>‚è∏Ô∏è</span>
                            <span>Pause / Arr√™t</span>
                        </button>
                        <button class="btn btn-secondary" style="flex: 1;" onclick="reportIssue()">
                            <span>‚ö†Ô∏è</span>
                            <span>Incident</span>
                        </button>
                        <button class="btn btn-success" style="flex: 2;" onclick="completeRide()">
                            <span>üèÅ</span>
                            <span>Terminer le trajet</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-bottom">
                <p>¬© 2025 EcoRide - Tous droits r√©serv√©s</p>
            </div>
        </div>
    </footer>

    <script src="js/theme.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/ride-active.js"></script>
</body>
</html>
